@using GPVBlazor.Models
@using GPVBlazor.Components.Displays
@using GPVBlazor.Components.Displays.Charts

@if (UserStats is not null)
{
    <div class="box mt-4 mb-5 fade-in-up">
        <h2 class="title is-3">
            <span class="icon has-text-primary">
                <i class="fas fa-chart-bar"></i>
            </span>
            <span>Statistics & Insights</span>
        </h2>
        <div>
            <div class="columns is-multiline">
                @if (user != null && user?.CreatedAt != null)
                {
                    var profileAge = DateTimeOffset.UtcNow.Year - user.CreatedAt.Year;
                    <div class="column is-4">
                        <div class="box has-text-primary">
                            <span class="icon">
                                <i class="fas fa-birthday-cake"></i>
                            </span>
                            <strong>Profile Age:</strong> @profileAge years
                        </div>
                    </div>
                }
                <div class="column is-4">
                    <div class="box has-text-info">
                        <span class="icon">
                            <i class="fas fa-code-branch"></i>
                        </span>
                        <strong>Public Repositories:</strong> @UserStats.TotalRepositories
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-link">
                        <span class="icon">
                            <i class="fas fa-file-code"></i>
                        </span>
                        <strong>Public Gists:</strong> @user?.PublicGists
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-warning">
                        <span class="icon">
                            <i class="fas fa-archive"></i>
                        </span>
                        <strong>Archived Repositories:</strong> @UserStats.TotalArchivedRepositories
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-success">
                        <span class="icon">
                            <i class="fas fa-code"></i>
                        </span>
                        <strong>Languages Used:</strong> @UserStats.TotalLanguages
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-danger">
                        <span class="icon">
                            <i class="fas fa-star"></i>
                        </span>
                        <strong>Total Stars:</strong> @UserStats.TotalStars
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-primary">
                        <span class="icon">
                            <i class="fas fa-tags"></i>
                        </span>
                        <strong>Total Topics:</strong> @UserStats.TotalTopics
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-info">
                        <span class="icon">
                            <i class="fas fa-code-branch"></i>
                        </span>
                        <strong>Total Forks:</strong> @UserStats.TotalForks
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-link">
                        <span class="icon">
                            <i class="fas fa-book"></i>
                        </span>
                        <strong>Readme Files:</strong> @UserStats.TotalReadmes
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-warning">
                        <span class="icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </span>
                        <strong>Open Issues:</strong> @UserStats.TotalOpenIssues
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-success">
                        <span class="icon">
                            <i class="fas fa-chart-line"></i>
                        </span>
                        <strong>Avg Stars/Repo:</strong> @UserStats.AverageStarsPerRepository
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-text-danger">
                        <span class="icon">
                            <i class="fas fa-chart-area"></i>
                        </span>
                        <strong>Avg Forks/Repo:</strong> @UserStats.AverageForksPerRepository
                    </div>
                </div>
            </div>

            <hr class="my-5" />

            <h3 class="title is-4 mb-4">
                <span class="icon has-text-primary">
                    <i class="fas fa-trophy"></i>
                </span>
                <span>Top Repositories</span>
            </h3>
            <div class="columns is-multiline">
                <div class="column is-6">
                    <RepositoryDisplay repository="@UserStats.MostStarred" Title="🌟 Most Starred" Token="@Token" />
                </div>
                <div class="column is-6">
                    <RepositoryDisplay repository="@UserStats.LatestUpdatedRepository" Title="🔄 Latest Updated" Token="@Token" />
                </div>
                <div class="column is-6">
                    <RepositoryDisplay repository="@UserStats.LastCreatedRepository" Title="🆕 Recently Created" Token="@Token" />
                </div>
                <div class="column is-6">
                    <RepositoryDisplay repository="@UserStats.OldestRepository" Title="🏛️ Oldest Repository" Token="@Token" />
                </div>
                <div class="column is-6">
                    <RepositoryDisplay repository="@UserStats.LongestUpdatePeriod" Title="⏱️ Longest Update Period" Token="@Token" />
                </div>
            </div>

            <hr class="my-5" />

            <h3 class="title is-4 mb-4">
                <span class="icon has-text-primary">
                    <i class="fas fa-chart-pie"></i>
                </span>
                <span>Visual Analytics</span>
            </h3>
            <div class="columns is-multiline">
                <div class="column is-6">
                    <ChartDisplay Data="@UserStats.TopTopics" Title="Top Topics" />
                </div>
                <div class="column is-6">
                    <ChartDisplay Data="@UserStats.StarsPerRepository" Title="Stars per Repository" />
                </div>
                <div class="column is-6">
                    <ChartDisplay Data="@UserStats.UsedLanguages" Title="Top Used Languages" />
                </div>
                <div class="column is-6">
                    <ChartDisplay Data="@UserStats.UsedLicenses" Title="Top Used Licenses" />
                </div>
                <div class="column is-12">
                    <ChartDisplay Data="@UserStats.RepositoriesByYear" Title="Repositories by Year" />
                </div>
            </div>
        </div>
    </div>
}


@code {
    [Parameter] public RepositoryStats? UserStats { get; set; }
    [Parameter] public List<Repository>? Repositories { get; set; }
    [Parameter] public User? user { get; set; }
    [Parameter] public string? Token { get; set; }
}